# SaberAPI
SaberAPI - маленькое приложение для демонстрации работы паттерна Издатель-Подписчик.  
В нём используются одновременно два подхода - Flow API, входящий в состав стандартного java.util.concurrent, 
и Project Reactor, являющийся частью Spring Framework.

## Что происходит в приложении?
При запуске создаётся некий владелец, имеющий четверых животных - кошку, собаку, рыбку и змею.  
Кошка и собака - "активные" животные, они реализуют интерфейсы Flow API. 
Рыбка и змейка - "медленные" животные и реализуют интерфейсы Project Reactor соответственно.  
У каждого животного есть метод applyCommand(), в котором описано их поведение при получении некого события. 
При этом собака (активное животное) и рыбка (медленное животное) имеют продуманное, адекватное поведение. 
В свою очередь кошка и змея при получении события просто засыпают на 30 секунд.  
**Зачем это нужно?**  
Для того, чтобы иметь возможность переполнить очередь подписчика и посмотреть на его поведение в таком случае.

## Как достигается имитация деятельности?
В пакете saber.api.tasks* создаётся ряд периодических тасок:  
1) *saber.api.tasks.ChangeModeTask* - меняет состояние владельца между *OwnerMode.WORKING* и *OwnerMode.RESTING* каждые 10 секунд;
2) *saber.api.tasks.DogsAwooTask* - вынуждает собаку без конца выть, если хозяин не дома и её терпение подошло к концу;
3) *saber.api.tasks.SomethingWrongTask* - дополнительная таска, влияющая на частоту зависаний кота и змеи. Если уменьшить в настройках её периодичность - можно спровоцировать быстрое переполнение очереди.

Первая и последняя создают new Event(), с помощью которого все подписчики оповещаются о произошедших изменениях.

## Где происходит уведомление о событии?
При создании каждое животное обращается в *saber.api.common.EventsController*, чтобы подписаться на изменения в жизни их владельца.  
Для активных и медленных животных создаются соответствующие им Publisher. 
Затем при обращении к методу *saber.api.common.EventsController.submit* каждое из них уведомляется об изменениях.  
Для удобства отслеживания обработки событий животными, которые уснули, каждому событию в рамках этого метода присваивается номер, который затем логируется в нём и в методе обработки животных.